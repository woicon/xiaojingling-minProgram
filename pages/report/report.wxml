<import src="../../pages/template/loading.wxml" />
<import src="../../template/header.wxml" />
<template is="headerReport" data="{{headHeight:headHeight,navBar:navBar,store:store,selStore:selStore}}" />
<view wx:if="{{isPageLoad}}" class='empty'>
    <template is="bottomloading" />
</view>
<block wx:else>
    <view class='report-head' style='top:{{headHeight}}px;{{currentCat == 2 ? "":""}}'>
        <view class='navbar ' bindtap='toggleCat'>
            <view wx:for="{{navBar}}" style='width:33.33333%' class='bline {{currentCat==index ? "active" : ""}}' wx:key="navBar" id="{{index}}">{{item}}</view>
        </view>
        <block wx:if="{{currentCat == 2}}">
            <view class='p-tab bline'>
                <picker range='{{couponList}}' mode='selector' range-key='couponName' bindchange='changeCoupon'>
                    <view> 全部优惠券</view>
                </picker>
                <picker range='{{employeeList}}' mode='selector' range-key='operatorName' bindchange='changeEmployee'>
                    <view>全部店员</view>
                </picker>
            </view>
            <view class='p-head bline'>
                <view>
                    <view class='p-num'>{{todayCount}}</view>今天核销</view>
                <view>
                    <view class='p-num'>{{yesterdayCount}}</view>昨日核销</view>
            </view>
            <view class='tab'>
                <view bindtap='toggleCheckTab' wx:for="{{['近7天','近30天','更多']}}" data-id="{{index}}" wx:key="checkTab" class='{{currentCheck == index?"active":""}}'>{{item}}</view>
            </view>
        </block>
        <block wx:else>
            <view class='tab'>
                <view wx:for="{{['昨日','今日','其他']}}" bindtap='toggleReport' wx:key="reportTab" class='{{reportTab == index ? "active":""}}' data-index="{{index}}">{{item}}</view>
            </view>
            <view class='datebar bline' bindtap='stepDate'>
                <view wx:if="{{!disPrv}}" class='ico prev' id='prev'></view>
                <view class='datevalue'> {{searchDates || reportDateFormat}} </view>
                <view wx:if="{{!disNext}}" class='ico next' id="next"></view>
            </view>
        </block>
    </view>
    <scroll-view scroll-y class='scroll-report {{isPX?"pxScroll":""}}' style='top:{{120+headHeight}}px;top:{{currentCat==2 ?headHeight+40+120+50+"px":""}}'>
        <!-- <import src="trade.wxml" />
        <import src="member.wxml" />
        <import src="recharge.wxml" /> -->
        <!-- <template wx:if="{{currentCat == 0}}" is="trade" />
        <template wx:elif="{{currentCat == 1}}" is="member" />
        <template wx:elif="{{currentCat == 2}}" is="recharge" /> -->
        <block wx:if="{{srcollLoading}}">
            <view class='pageloading'>
                <template is="bottomloading" />
            </view>
        </block>
        <block wx:elif="{{currentCat == 0}}">
            <block wx:if="{{role!= 2}}">
                <view class='r bline'>
                    <view class='r-grid'>
                        <!-- <view class='bline'>
                            <view class='ico icon-iorders'></view>
                            <view>订单数
                                <view class='value'>{{trade.totalOrderCnt}}</view>
                            </view>
                        </view> -->
                        <view class='bline'>
                            <view class='ico icon-money'></view>
                            <view>订单金额/笔
                                <view class='value'>{{trade.totalOrderAmt}}/{{trade.totalOrderCnt}}</view>
                            </view>
                        </view>
                        <view class='bline lline'>
                            <view class='ico icon-moneys'></view>
                            <view>实收金额/笔
                                <view class='value'>{{trade.totalTradeAmt}}/{{trade.totalTradeCnt}}</view>
                            </view>
                        </view>
                        <view class='bline'>
                            <view class='ico icon-refund'></view>
                            <view>退款金额(元)/笔
                                <view class='value'>{{trade.totalRefundAmt}}/{{trade.totalRefundCnt}}</view>
                            </view>
                        </view>
                        <view class='bline lline'>
                            <view class='ico icon-fee'></view>
                            <view>
                                <view>手续费</view>
                                <view class='value'>{{trade.totalTradeFee}}</view>
                            </view>
                        </view>
                        <view>
                            <view class='ico icon-fee'></view>
                            <view>
                                <view>优惠金额/笔</view>
                                <view class='value'>{{trade.wechatDiscountableAmt}}/{{trade.wechatDiscountableCnt}}</view>
                            </view>
                        </view>
                        <view class='lline'>
                            <view class='ico icon-bag'></view>
                            <view>
                                <view>结算金额(元)</view>
                                <view class='value'>{{trade.totalSettleAmt}}</view>
                            </view>
                        </view>
                    </view>
                </view>
                <view class="r-info">
                    <view class='ico icon-warn'></view>
                    实收金额=订单金额-退款金额 结算金额=实收金额-手续费
                </view>
                <view class='r-title'>支付方式统计</view>
                <view class='rs'>
                    <view class='rs-title'>
                        <view class="ico icon-weixin weixin"></view>
                        <view>微信支付</view>
                    </view>
                    <view class='rs-block'>
                        <view class='bline'>订单金额
                            <text>{{trade.wechatOrderAmt}}</text>
                        </view>
                        <view class='bline lline'>退款金额/笔数
                            <text>{{trade. wechatRefundAmt}}/{{trade.wechatRefundCnt}}</text>
                        </view>
                        <view class='bline lline'>实收金额
                            <text>{{trade.wechatTradeAmt}}</text>
                        </view>
                        <view class="">实收笔数
                            <text>{{trade.wechatTradeCnt}}</text>
                        </view>
                        <view class='lline'>手续费
                            <text>{{trade.wechatTradeFee}}</text>
                        </view>
                        <view class='lline'>结算金额
                            <text>{{trade.wechatSettleAmt}}</text>
                        </view>

                    </view>
                </view>
                <view class='rs'>
                    <view class='rs-title'>
                        <view class='ico icon-alipay alipay'></view>
                        <view>支付宝支付</view>
                    </view>
                    <view class='rs-block'>
                        <view class='bline'>订单金额
                            <text>{{trade.alipayOrderAmt}}</text>
                        </view>
                        <view class='bline lline'>退款金额/笔数
                            <text>{{trade.alipayRefundAmt}}/{{trade.alipayRefundCnt}}</text>
                        </view>
                        <view class='bline lline'>实收金额
                            <text>{{trade.alipayTradeAmt}}</text>
                        </view>
                        <view>实收笔数
                            <text>{{trade.alipayTradeCnt}}</text>
                        </view>
                        <view class='lline'>手续费
                            <text>{{trade.alipayTradeFee}}</text>
                        </view>
                        <view class='lline'>结算金额
                            <text>{{trade.alipaySettleAmt}}</text>
                        </view>
                    </view>
                </view>

                <view class='rs'>
                    <view class='rs-title'>
                        <view class='ico icon-vip vip'></view>
                        <view>会员支付</view>
                    </view>
                    <view class='rs-block'>
                        <view class='bline'>消费金额/笔
                            <text>{{trade.memberOrderAmt}}/{{trade.memberTradeCnt}}</text>
                        </view>
                        <view class='bline lline'>退款金额/笔数
                            <text>{{trade.memberRefundAmt}}/{{trade.memberRefundCnt}}</text>
                        </view>
                        <view class='bline lline'>实充消费金额/笔
                            <text>{{trade.memberActualAmt}}/{{trade.memberActualCnt}}</text>
                        </view>
                        <view>优惠金额/笔
                            <text>{{trade.memberDiscountableAmt}}/{{trade.memberDiscountableCnt}}</text>
                        </view>
                        <view class='lline'>赠送消费金额/笔
                            <text>{{trade.memberGiveAmt}}/{{trade.memberGiveCnt}}</text>
                        </view>
                        <view class='lline'>实付金额/笔
                            <text>{{trade.memberTradeAmt}}/{{trade.memberTradeCnt}}</text>
                        </view>
                    </view>
                </view>
            </block>
            <block wx:if="{{terminal && terminal.length!=0}}">
                <view class='r-title'>款台统计</view>
                <detail details="{{terminal}}"></detail>
            </block>
            <block wx:if="{{cashier && cashier.length!=0}}">
                <view class='r-title' wx:if="{{role!=2}}">收银员统计</view>
                <detail details="{{cashier.statisticsList}}"></detail>
                <view class='more' bindtap='moreCashier' wx:if="{{cashier.totalPage > 1 && cashier.pageNumber < cashier.totalPage}}">查看更多</view>
            </block>
            <block wx:elif="{{department && department.length!=0}}">
                <view class='r-title'>门店统计</view>
                <detail details="{{department.statisticsList}}"></detail>
                <view class='more' bindtap='moreDepartment' wx:if="{{department.totalPage>1 && department.pageNumber < department.totalPage}}">查看更多</view>
            </block>
            <block wx:if="{{cashier.length === 0 && member.identity == 5}}">
                <view class='empty'>
                    <view class='ico icon-icos'></view>
                    <view class='txt'>暂时没有数据</view>
                </view>
            </block>
        </block>
        <block wx:elif="{{currentCat == 1}}">
            <view class='r bline'>
                <view class='r-grid'>
                    <!-- <view class='bline'>
                            <view class='ico icon-iorders'></view>
                            <view>订单数
                                <view class='value'>{{trade.totalOrderCnt}}</view>
                            </view>
                        </view> -->
                    <view class='bline'>
                        <view class='ico icon-money'></view>
                        <view>新增会员
                            <view class='value'>{{memberCount}}</view>
                        </view>
                    </view>
                    <view class='bline lline'>
                        <view class='ico icon-moneys'></view>
                        <view>新增充值/笔
                            <view class='value'>{{recharge.totalOrderAmt}}/{{recharge.totalTradeCnt}}</view>
                        </view>
                    </view>
                </view>
            </view>
            <view class='r'>
                <view class='r-title'>会员充值统计</view>
                <view class='rs-block'>
                    <view class='bline'>新增充值/笔
                        <text>{{recharge.totalOrderAmt + recharge.totalGiveAmt}}/{{recharge.totalOrderCnt}}</text>
                    </view>
                    <view class='bline lline'>实充金额（元）
                        <text>{{recharge.totalTradeAmt}}</text>
                    </view>
                    <view class='bline lline'>赠送金额（元）
                        <text>{{recharge.totalGiveAmt}}</text>
                    </view>
                    <view>会员充值手续费（元）
                        <text>{{recharge.totalTradeFee}}</text>
                    </view>

                    <view class='lline'>结算金额
                        <text>{{recharge.totalOrderAmt + recharge.totalTradeFee}}</text>
                    </view>
                </view>
            </view>
            <view class="r-info">
                <view class='ico icon-warn'></view>
                <view>
                    <view>新增充值 = 实充金额+赠送金额</view>
                    <view>结算金额 = 实充金额+充值手续费</view>
                </view>
            </view>
            <view class='r'>
                <view class='r-title'>支付方式统计</view>
                <view class='rs'>
                    <view class='rs-title'>
                        <view class="ico icon-weixin weixin"></view>
                        <view>微信支付</view>
                    </view>
                    <view class='r-grid r-grid-min'>
                        <view class='bline'>
                            <view>微信实充金额
                                <view class='value'>{{recharge.wechatOrderAmt}}</view>
                            </view>
                        </view>
                        <view class='bline lline'>
                            <view>
                                微信实充笔数
                                <view class='value'>{{recharge.wechatOrderCnt}}</view>
                            </view>
                        </view>
                        <view class=" lline">
                            <view>微信实充手续费
                                <view class='value'>{{recharge.wechatTradeFee}}</view>
                            </view>
                        </view>
                        <view class=" lline">
                            <view>微信实充结算金额
                                <view class='value'>{{recharge.wechatTradeAmt + recharge.wechatTradeFee}}</view>
                            </view>
                        </view>
                    </view>
                </view>

                <view class='rs'>
                    <view class='rs-title'>
                        <view class='ico icon-alipay alipay'></view>
                        <view>支付宝支付</view>
                    </view>
                    <view class='r-grid r-grid-min'>
                        <view class='bline'>
                            <view>支付宝实充金额
                                <view class='value'>{{recharge.alipayOrderAmt}}</view>
                            </view>
                        </view>
                        <view class='bline lline'>
                            <view>支付宝实充笔数
                                <view class='value'>{{recharge.alipayOrderCnt}}</view>
                            </view>
                        </view>
                        <view class=" lline">
                            <view>支付宝实充手续费
                                <view class='value'>{{recharge.alipayTradeFee}}</view>
                            </view>
                        </view>
                        <view class=" lline">
                            <view>支付宝实充结算金额
                                <view class='value'>{{recharge.alipayTradeAmt + recharge.alipayTradeFee}}</view>
                            </view>
                        </view>
                    </view>
                </view>
            </view>

            <view class='r'>
                <view class='r-title'>会员卡统计</view>
                <view class='r-grid r-grid-min'>
                    <view class='bline'>
                        <view>会员消费金额/笔数
                            <view class='value'>{{trade.memberActualAmt}}/{{trade.memberActualCnt}}</view>
                        </view>
                    </view>
                    <view class='bline lline'>
                        <view>会员支付退款金额/笔数
                            <view class='value'>{{trade.memberRefundAmt}}/{{trade.memberRefundCnt}}</view>
                        </view>
                    </view>
                    <view class='bline'>
                        <view>退回实充金额/笔数
                            <view class='value'>{{trade.memberRefundActualAmt}}/{{trade.memberRefundActualCnt}}</view>
                        </view>
                    </view>
                    <view class='bline lline'>
                        <view>退回赠送金额
                            <view class='value'>{{trade.memberRefundGiveAmt}}</view>
                        </view>
                    </view>
                </view>
            </view>
        </block>
        <block wx:elif="{{currentCat == 2}}">
            <view>
                <view wx:for="{{recordList}}" wx:key="recordList" class='bline r-item'>
                    <view>
                        <view class='coupon-title'>{{item.couponName}}</view>
                        <view> {{item.memberName}}</view>
                    </view>
                    <view class='coupon-bar'>
                        <view>券号：{{item.couponNo}}</view>
                        <view>{{item.consumeTime}}</view>
                    </view>
                </view>
            </view>
        </block>
    </scroll-view>
</block>